!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";module.exports=Buffer;var ieee754=require("ieee754"),BufferMethods,lastStr,lastStrEncoded;function Buffer(length){var arr;length&&length.length&&(length=(arr=length).length);var buf=new Uint8Array(length||0);return arr&&buf.set(arr),buf.readUInt32LE=BufferMethods.readUInt32LE,buf.writeUInt32LE=BufferMethods.writeUInt32LE,buf.readInt32LE=BufferMethods.readInt32LE,buf.writeInt32LE=BufferMethods.writeInt32LE,buf.readFloatLE=BufferMethods.readFloatLE,buf.writeFloatLE=BufferMethods.writeFloatLE,buf.readDoubleLE=BufferMethods.readDoubleLE,buf.writeDoubleLE=BufferMethods.writeDoubleLE,buf.toString=BufferMethods.toString,buf.write=BufferMethods.write,buf.slice=BufferMethods.slice,buf.copy=BufferMethods.copy,buf._isBuffer=!0,buf}function encodeString(str){for(var length=str.length,bytes=[],i=0,c,lead;i<length;i++){if((c=str.charCodeAt(i))>55295&&c<57344){if(!lead){c>56319||i+1===length?bytes.push(239,191,189):lead=c;continue}if(c<56320){bytes.push(239,191,189),lead=c;continue}c=lead-55296<<10|c-56320|65536,lead=null}else lead&&(bytes.push(239,191,189),lead=null);c<128?bytes.push(c):c<2048?bytes.push(c>>6|192,63&c|128):c<65536?bytes.push(c>>12|224,c>>6&63|128,63&c|128):bytes.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}return bytes}(BufferMethods={readUInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+16777216*this[pos+3]},writeUInt32LE:function(val,pos){this[pos]=val,this[pos+1]=val>>>8,this[pos+2]=val>>>16,this[pos+3]=val>>>24},readInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+(this[pos+3]<<24)},readFloatLE:function(pos){return ieee754.read(this,pos,!0,23,4)},readDoubleLE:function(pos){return ieee754.read(this,pos,!0,52,8)},writeFloatLE:function(val,pos){return ieee754.write(this,val,pos,!0,23,4)},writeDoubleLE:function(val,pos){return ieee754.write(this,val,pos,!0,52,8)},toString:function(encoding,start,end){var str="",tmp="";start=start||0,end=Math.min(this.length,end||this.length);for(var i=start;i<end;i++){var ch=this[i];ch<=127?(str+=decodeURIComponent(tmp)+String.fromCharCode(ch),tmp=""):tmp+="%"+ch.toString(16)}return str+=decodeURIComponent(tmp)},write:function(str,pos){for(var bytes=str===lastStr?lastStrEncoded:encodeString(str),i=0;i<bytes.length;i++)this[pos+i]=bytes[i]},slice:function(start,end){return this.subarray(start,end)},copy:function(buf,pos){pos=pos||0;for(var i=0;i<this.length;i++)buf[pos+i]=this[i]}}).writeInt32LE=BufferMethods.writeUInt32LE,Buffer.byteLength=function(str){return lastStr=str,(lastStrEncoded=encodeString(str)).length},Buffer.isBuffer=function(buf){return!(!buf||!buf._isBuffer)}},{ieee754:3}],2:[function(require,module,exports){(function(global){"use strict";module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");function Pbf(buf){this.buf=Buffer.isBuffer(buf)?buf:new Buffer(buf||0),this.pos=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/4294967296,POW_2_63=Math.pow(2,63);function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){for(end=end||this.length;this.pos<end;){var val=this.readVarint(),tag=val>>3,startPos=this.pos;readField(tag,result,this),this.pos===startPos&&this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=this.buf.readUInt32LE(this.pos);return this.pos+=4,val},readSFixed32:function(){var val=this.buf.readInt32LE(this.pos);return this.pos+=4,val},readFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readUInt32LE(this.pos+4);return this.pos+=8,val},readSFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readInt32LE(this.pos+4);return this.pos+=8,val},readFloat:function(){var val=this.buf.readFloatLE(this.pos);return this.pos+=4,val},readDouble:function(){var val=this.buf.readDoubleLE(this.pos);return this.pos+=8,val},readVarint:function(){var buf=this.buf,val,b,b0,b1,b2,b3;if((b0=buf[this.pos++])<128)return b0;if(b0&=127,(b1=buf[this.pos++])<128)return b0|b1<<7;if(b1=(127&b1)<<7,(b2=buf[this.pos++])<128)return b0|b1|b2<<14;if(b2=(127&b2)<<14,(b3=buf[this.pos++])<128)return b0|b1|b2|b3<<21;if(val=b0|b1|b2|(127&b3)<<21,val+=268435456*(127&(b=buf[this.pos++])),b<128)return val;if(val+=34359738368*(127&(b=buf[this.pos++])),b<128)return val;if(val+=4398046511104*(127&(b=buf[this.pos++])),b<128)return val;if(val+=562949953421312*(127&(b=buf[this.pos++])),b<128)return val;if(val+=72057594037927940*(127&(b=buf[this.pos++])),b<128)return val;if(val+=0x8000000000000000*(127&(b=buf[this.pos++])),b<128)return val;throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){var startPos=this.pos,val=this.readVarint();if(val<POW_2_63)return val;for(var pos=this.pos-2;255===this.buf[pos];)pos--;pos<startPos&&(pos=startPos),val=0;for(var i=0;i<pos-startPos+1;i++){var b=127&~this.buf[startPos+i];val+=i<4?b<<7*i:b*Math.pow(2,7*i)}return-val-1},readSVarint:function(){var num=this.readVarint();return num%2==1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,str=this.buf.toString("utf8",this.pos,end);return this.pos=end,str},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.slice(this.pos,end);return this.pos=end,buffer},readPackedVarint:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readVarint());return arr},readPackedSVarint:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSVarint());return arr},readPackedBoolean:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readBoolean());return arr},readPackedFloat:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFloat());return arr},readPackedDouble:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readDouble());return arr},readPackedFixed32:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(){for(var end=this.readVarint()+this.pos,arr=[];this.pos<end;)arr.push(this.readSFixed64());return arr},skip:function(val){var type=7&val;if(type===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else{if(type!==Pbf.Fixed64)throw new Error("Unimplemented type: "+type);this.pos+=8}},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){for(var length=this.length||16;length<this.pos+min;)length*=2;if(length!==this.length){var buf=new Buffer(length);this.buf.copy(buf),this.buf=buf,this.length=length}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(val){this.realloc(4),this.buf.writeUInt32LE(val,this.pos),this.pos+=4},writeSFixed32:function(val){this.realloc(4),this.buf.writeInt32LE(val,this.pos),this.pos+=4},writeFixed64:function(val){this.realloc(8),this.buf.writeInt32LE(-1&val,this.pos),this.buf.writeUInt32LE(Math.floor(val*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(val){this.realloc(8),this.buf.writeInt32LE(-1&val,this.pos),this.buf.writeInt32LE(Math.floor(val*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(val){if((val=+val)<=127)this.realloc(1),this.buf[this.pos++]=val;else if(val<=16383)this.realloc(2),this.buf[this.pos++]=val>>>0&127|128,this.buf[this.pos++]=val>>>7&127;else if(val<=2097151)this.realloc(3),this.buf[this.pos++]=val>>>0&127|128,this.buf[this.pos++]=val>>>7&127|128,this.buf[this.pos++]=val>>>14&127;else if(val<=268435455)this.realloc(4),this.buf[this.pos++]=val>>>0&127|128,this.buf[this.pos++]=val>>>7&127|128,this.buf[this.pos++]=val>>>14&127|128,this.buf[this.pos++]=val>>>21&127;else{for(var pos=this.pos;val>=128;)this.realloc(1),this.buf[this.pos++]=255&val|128,val/=128;if(this.realloc(1),this.buf[this.pos++]=0|val,this.pos-pos>10)throw new Error("Given varint doesn't fit into 10 bytes")}},writeSVarint:function(val){this.writeVarint(val<0?2*-val-1:2*val)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes),this.realloc(bytes),this.buf.write(str,this.pos),this.pos+=bytes},writeFloat:function(val){this.realloc(4),this.buf.writeFloatLE(val,this.pos),this.pos+=4},writeDouble:function(val){this.realloc(8),this.buf.writeDoubleLE(val,this.pos),this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len),this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){this.pos++;var startPos=this.pos;fn(obj,this);var len=this.pos-startPos,varintLen=len<=127?1:len<=16383?2:len<=2097151?3:len<=268435455?4:Math.ceil(Math.log(len)/(7*Math.LN2));if(varintLen>1){this.realloc(varintLen-1);for(var i=this.pos-1;i>=startPos;i--)this.buf[i+varintLen-1]=this.buf[i]}this.pos=startPos-1,this.writeVarint(len),this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes),this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes),this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes),this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":1}],3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],4:[function(require,module,exports){"use strict";function Point(x,y){this.x=x,this.y=y}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var x=m[0]*this.x+m[1]*this.y,y=m[2]*this.x+m[3]*this.y;return this.x=x,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),x=cos*this.x-sin*this.y,y=sin*this.x+cos*this.y;return this.x=x,this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a}},{}],5:[function(require,module,exports){module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js")},{"./lib/vectortile.js":6,"./lib/vectortilefeature.js":7,"./lib/vectortilelayer.js":8}],6:[function(require,module,exports){"use strict";var VectorTileLayer=require("./vectortilelayer");function VectorTile(pbf,end){this.layers=pbf.readFields(readTile,{},end)}function readTile(tag,layers,pbf){if(3===tag){var layer=new VectorTileLayer(pbf,pbf.readVarint()+pbf.pos);layer.length&&(layers[layer.name]=layer)}}module.exports=VectorTile},{"./vectortilelayer":8}],7:[function(require,module,exports){"use strict";var Point=require("point-geometry");function VectorTileFeature(pbf,end,extent,keys,values){this.properties={},this.extent=extent,this.type=0,this._pbf=pbf,this._geometry=-1,this._keys=keys,this._values=values,pbf.readFields(readFeature,this,end)}function readFeature(tag,feature,pbf){1==tag?feature._id=pbf.readVarint():2==tag?readTag(pbf,feature):3==tag?feature.type=pbf.readVarint():4==tag&&(feature._geometry=pbf.pos)}function readTag(pbf,feature){for(var end=pbf.readVarint()+pbf.pos;pbf.pos<end;){var key=feature._keys[pbf.readVarint()],value=feature._values[pbf.readVarint()];feature.properties[key]=value}}module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var pbf=this._pbf;pbf.pos=this._geometry;for(var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,lines=[],line;pbf.pos<end;){if(!length){var cmdLen=pbf.readVarint();cmd=7&cmdLen,length=cmdLen>>3}if(length--,1===cmd||2===cmd)x+=pbf.readSVarint(),y+=pbf.readSVarint(),1===cmd&&(line&&lines.push(line),line=[]),line.push(new Point(x,y));else{if(7!==cmd)throw new Error("unknown command "+cmd);line&&line.push(line[0].clone())}}return line&&lines.push(line),lines},VectorTileFeature.prototype.bbox=function(){var pbf=this._pbf;pbf.pos=this._geometry;for(var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0;pbf.pos<end;){if(!length){var cmdLen=pbf.readVarint();cmd=7&cmdLen,length=cmdLen>>3}if(length--,1===cmd||2===cmd)(x+=pbf.readSVarint())<x1&&(x1=x),x>x2&&(x2=x),(y+=pbf.readSVarint())<y1&&(y1=y),y>y2&&(y2=y);else if(7!==cmd)throw new Error("unknown command "+cmd)}return[x1,y1,x2,y2]},VectorTileFeature.prototype.toGeoJSON=function(x,y,z){for(var size=this.extent*Math.pow(2,z),x0=this.extent*x,y0=this.extent*y,coords=this.loadGeometry(),type=VectorTileFeature.types[this.type],i=0;i<coords.length;i++)for(var line=coords[i],j=0;j<line.length;j++){var p=line[j],y2=180-360*(p.y+y0)/size;line[j]=[360*(p.x+x0)/size-180,360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90]}return"Point"===type&&1===coords.length?coords=coords[0][0]:"Point"===type?(coords=coords[0],type="MultiPoint"):"LineString"===type&&1===coords.length?coords=coords[0]:"LineString"===type&&(type="MultiLineString"),{type:"Feature",geometry:{type:type,coordinates:coords},properties:this.properties}}},{"point-geometry":4}],8:[function(require,module,exports){"use strict";var VectorTileFeature=require("./vectortilefeature.js");function VectorTileLayer(pbf,end){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=pbf,this._keys=[],this._values=[],this._features=[],pbf.readFields(readLayer,this,end),this.length=this._features.length}function readLayer(tag,layer,pbf){15===tag?layer.version=pbf.readVarint():1===tag?layer.name=pbf.readString():5===tag?layer.extent=pbf.readVarint():2===tag?layer._features.push(pbf.pos):3===tag?layer._keys.push(pbf.readString()):4===tag&&layer._values.push(readValueMessage(pbf))}function readValueMessage(pbf){for(var value=null,end=pbf.readVarint()+pbf.pos;pbf.pos<end;){var tag=pbf.readVarint()>>3;value=1===tag?pbf.readString():2===tag?pbf.readFloat():3===tag?pbf.readDouble():4===tag?pbf.readVarint64():5===tag?pbf.readVarint():6===tag?pbf.readSVarint():7===tag?pbf.readBoolean():null}return value}module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var end=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,end,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":7}],9:[function(require,module,exports){var Util=require("./MVTUtil"),StaticLabel=require("./StaticLabel/StaticLabel.js");function MVTFeature(mvtLayer,vtf,ctx,id,style){if(!vtf)return null;for(var key in vtf)this[key]=vtf[key];this.mvtLayer=mvtLayer,this.mvtSource=mvtLayer.mvtSource,this.map=mvtLayer.mvtSource.map,this.id=id,this.layerLink=this.mvtSource.layerLink,this.toggleEnabled=!0,this.selected=!1,this.divisor=vtf.extent/ctx.tileSize,this.extent=vtf.extent,this.tileSize=ctx.tileSize,this.tiles={},this.style=style,this.addTileFeature(vtf,ctx);var self=this;this.map.on("zoomend",function(){self.staticLabel=null}),style&&style.dynamicLabel&&"function"==typeof style.dynamicLabel&&(this.dynamicLabel=this.mvtSource.dynamicLabel.createFeature(this)),ajax(self)}function ajax(self){var style=self.style;if(style&&style.ajaxSource&&"function"==typeof style.ajaxSource){var ajaxEndpoint=style.ajaxSource(self);ajaxEndpoint&&Util.getJSON(ajaxEndpoint,function(error,response,body){if(error)throw["ajaxSource AJAX Error",error];return ajaxCallback(self,response),!0})}return!1}function ajaxCallback(self,response){self.ajaxData=response,"function"==typeof self.ajaxDataReceived&&self.ajaxDataReceived(self,response),self._setStyle(self.mvtLayer.style),redrawTiles(self)}function redrawTiles(self){var tiles=self.tiles,mvtLayer=self.mvtLayer;for(var id in tiles){var tileZoom,mapZoom;parseInt(id.split(":")[0])===self.map.getZoom()&&mvtLayer.redrawTile(id)}}module.exports=MVTFeature,MVTFeature.prototype._setStyle=function(styleFn){this.style=styleFn(this,this.ajaxData),this.removeLabel()},MVTFeature.prototype.setStyle=function(styleFn){var hasAjaxSource;this.ajaxData=null,this.style=styleFn(this,null),ajax(this)||this.removeLabel()},MVTFeature.prototype.draw=function(canvasID){var tileInfo=this.tiles[canvasID],vtf=tileInfo.vtf,ctx=tileInfo.ctx,xy=canvasID.split(":").slice(1,3).join(":");if(ctx.canvas=this.mvtLayer._tiles[xy],this.selected)var style=this.style.selected||this.style;else var style=this.style;switch(vtf.type){case 1:if(this._drawPoint(ctx,vtf.coordinates,style),!this.staticLabel&&"function"==typeof this.style.staticLabel){if(this.style.ajaxSource&&!this.ajaxData)break;this._drawStaticLabel(ctx,vtf.coordinates,style)}break;case 2:this._drawLineString(ctx,vtf.coordinates,style);break;case 3:this._drawPolygon(ctx,vtf.coordinates,style);break;default:throw new Error("Unmanaged type: "+vtf.type)}},MVTFeature.prototype.getPathsForTile=function(canvasID){return this.tiles[canvasID].paths},MVTFeature.prototype.addTileFeature=function(vtf,ctx){var zoom=this.map.getZoom();ctx.zoom==zoom&&(this.clearTileFeatures(zoom),this.tiles[ctx.id]={ctx:ctx,vtf:vtf,paths:[]})},MVTFeature.prototype.clearTileFeatures=function(zoom){for(var key in this.tiles)key.split(":")[0]!=zoom&&delete this.tiles[key]},MVTFeature.prototype.toggle=function(){this.selected?this.deselect():this.select()},MVTFeature.prototype.select=function(){this.selected=!0,this.mvtSource.featureSelected(this),redrawTiles(this);var linkedFeature=this.linkedFeature();linkedFeature&&linkedFeature.staticLabel&&!linkedFeature.staticLabel.selected&&linkedFeature.staticLabel.select()},MVTFeature.prototype.deselect=function(){this.selected=!1,this.mvtSource.featureDeselected(this),redrawTiles(this);var linkedFeature=this.linkedFeature();linkedFeature&&linkedFeature.staticLabel&&linkedFeature.staticLabel.selected&&linkedFeature.staticLabel.deselect()},MVTFeature.prototype.on=function(eventType,callback){this._eventHandlers[eventType]=callback},MVTFeature.prototype._drawPoint=function(ctx,coordsArray,style){if(style&&ctx&&ctx.canvas){var tile=this.tiles[ctx.id],radius=1;radius="function"==typeof style.radius?style.radius(ctx.zoom):style.radius;var p=this._tilePoint(coordsArray[0][0]),c=ctx.canvas,ctx2d;try{ctx2d=c.getContext("2d")}catch(e){return void console.log("_drawPoint error: "+e)}ctx2d.beginPath(),ctx2d.fillStyle=style.color,ctx2d.arc(p.x,p.y,radius,0,2*Math.PI),ctx2d.closePath(),ctx2d.fill(),style.lineWidth&&style.strokeStyle&&(ctx2d.lineWidth=style.lineWidth,ctx2d.strokeStyle=style.strokeStyle,ctx2d.stroke()),ctx2d.restore(),tile.paths.push([p])}},MVTFeature.prototype._drawLineString=function(ctx,coordsArray,style){if(style&&ctx&&ctx.canvas){var ctx2d=ctx.canvas.getContext("2d");ctx2d.strokeStyle=style.color,ctx2d.lineWidth=style.size,ctx2d.beginPath();var projCoords=[],tile=this.tiles[ctx.id];for(var gidx in coordsArray){var coords=coordsArray[gidx];for(i=0;i<coords.length;i++){var method=(0===i?"move":"line")+"To",proj=this._tilePoint(coords[i]);projCoords.push(proj),ctx2d[method](proj.x,proj.y)}}ctx2d.stroke(),ctx2d.restore(),tile.paths.push(projCoords)}},MVTFeature.prototype._drawPolygon=function(ctx,coordsArray,style){if(style&&ctx&&ctx.canvas){var ctx2d=ctx.canvas.getContext("2d"),outline=style.outline;"function"==typeof style.color?ctx2d.fillStyle=style.color(ctx2d):ctx2d.fillStyle=style.color,outline&&(ctx2d.strokeStyle=outline.color,ctx2d.lineWidth=outline.size),ctx2d.beginPath();var projCoords=[],tile=this.tiles[ctx.id],featureLabel=this.dynamicLabel;featureLabel&&featureLabel.addTilePolys(ctx,coordsArray);for(var gidx=0,len=coordsArray.length;gidx<len;gidx++)for(var coords=coordsArray[gidx],i=0;i<coords.length;i++){var coord=coords[i],method=(0===i?"move":"line")+"To",proj=this._tilePoint(coords[i]);projCoords.push(proj),ctx2d[method](proj.x,proj.y)}ctx2d.closePath(),ctx2d.fill(),outline&&ctx2d.stroke(),tile.paths.push(projCoords)}},MVTFeature.prototype._drawStaticLabel=function(ctx,coordsArray,style){if(style&&ctx&&this.mvtLayer._map){var vecPt=this._tilePoint(coordsArray[0][0]),p=this._project(vecPt,ctx.tile.x,ctx.tile.y,this.extent,this.tileSize),mercPt=L.point(p.x,p.y),latLng=this.map.unproject(mercPt);this.staticLabel=new StaticLabel(this,ctx,latLng,style),this.mvtLayer.featureWithLabelAdded(this)}},MVTFeature.prototype.removeLabel=function(){this.staticLabel&&(this.staticLabel.remove(),this.staticLabel=null)},MVTFeature.prototype._project=function(vecPt,tileX,tileY,extent,tileSize){var xOffset=tileX*tileSize,yOffset=tileY*tileSize;return{x:Math.floor(vecPt.x+xOffset),y:Math.floor(vecPt.y+yOffset)}},MVTFeature.prototype._tilePoint=function(coords){return new L.Point(coords.x/this.divisor,coords.y/this.divisor)},MVTFeature.prototype.linkedFeature=function(){var linkedLayer=this.mvtLayer.linkedLayer(),linkedFeature;return linkedLayer?linkedLayer.features[this.id]:null}},{"./MVTUtil":12,"./StaticLabel/StaticLabel.js":13}],10:[function(require,module,exports){var MVTFeature=require("./MVTFeature"),Util=require("./MVTUtil");function removeLabels(self){for(var features=self.featuresWithLabels,i=0,len=features.length;i<len;i++){var feat;features[i].removeLabel()}self.featuresWithLabels=[]}function in_circle(center_x,center_y,radius,x,y){var square_dist;return Math.pow(center_x-x,2)+Math.pow(center_y-y,2)<=Math.pow(radius,2)}function waitFor(testFx,onReady,timeOutMillis){var maxtimeOutMillis=timeOutMillis||3e3,start=(new Date).getTime(),condition="string"==typeof testFx?eval(testFx):testFx(),interval=setInterval(function(){(new Date).getTime()-start<maxtimeOutMillis&&!condition?condition="string"==typeof testFx?eval(testFx):testFx():condition?(console.log("'waitFor()' finished in "+((new Date).getTime()-start)+"ms."),clearInterval(interval),"string"==typeof onReady?eval(onReady):onReady("success")):(console.log("'waitFor()' timeout"),clearInterval(interval),"string"==typeof onReady?eval(onReady):onReady("timeout"))},50)}module.exports=L.TileLayer.Canvas.extend({options:{debug:!1,isHiddenLayer:!1,getIDForLayerFeature:function(){},tileSize:256,lineClickTolerance:2},_featureIsClicked:{},_isPointInPoly:function(pt,poly){if(poly&&poly.length){for(var c=!1,i=-1,l=poly.length,j=l-1;++i<l;j=i)(poly[i].y<=pt.y&&pt.y<poly[j].y||poly[j].y<=pt.y&&pt.y<poly[i].y)&&pt.x<(poly[j].x-poly[i].x)*(pt.y-poly[i].y)/(poly[j].y-poly[i].y)+poly[i].x&&(c=!c);return c}},_getDistanceFromLine:function(pt,pts){var min=Number.POSITIVE_INFINITY;if(pts&&pts.length>1){pt=L.point(pt.x,pt.y);for(var i=0,l=pts.length-1;i<l;i++){var test=this._projectPointOnLineSegment(pt,pts[i],pts[i+1]);test.distance<=min&&(min=test.distance)}}return min},_projectPointOnLineSegment:function(p,r0,r1){var lineLength=r0.distanceTo(r1);if(lineLength<1)return{distance:p.distanceTo(r0),coordinate:r0};var u=((p.x-r0.x)*(r1.x-r0.x)+(p.y-r0.y)*(r1.y-r0.y))/Math.pow(lineLength,2);if(u<1e-7)return{distance:p.distanceTo(r0),coordinate:r0};if(u>.9999999)return{distance:p.distanceTo(r1),coordinate:r1};var a=L.point(r0.x+u*(r1.x-r0.x),r0.y+u*(r1.y-r0.y));return{distance:p.distanceTo(a),point:a}},initialize:function(mvtSource,options){var self=this;this.mvtSource=mvtSource,L.Util.setOptions(this,options),this.style=options.style,this.name=options.name,this._canvasIDToFeatures={},this.features={},this.featuresWithLabels=[],this._highestCount=0},onAdd:function(map){var self=this;self.map=map,L.TileLayer.Canvas.prototype.onAdd.call(this,map),map.on("layerremove",function(e){e.layer._leaflet_id===self._leaflet_id&&removeLabels(self)})},drawTile:function(canvas,tilePoint,zoom){var ctx={canvas:canvas,tile:tilePoint,zoom:zoom,tileSize:this.options.tileSize};ctx.id=Util.getContextID(ctx),this._canvasIDToFeatures[ctx.id]||this._initializeFeaturesHash(ctx),this.features||(this.features={})},_initializeFeaturesHash:function(ctx){this._canvasIDToFeatures[ctx.id]={},this._canvasIDToFeatures[ctx.id].features=[],this._canvasIDToFeatures[ctx.id].canvas=ctx.canvas},_draw:function(ctx){},getCanvas:function(parentCtx){var tilePoint=parentCtx.tile,ctx=this._tiles[tilePoint.x+":"+tilePoint.y];if(ctx)return parentCtx.canvas=ctx,void this.redrawTile(parentCtx.id);var self=this;waitFor(function(){if(ctx=self._tiles[tilePoint.x+":"+tilePoint.y])return!0},function(){ctx=self._tiles[tilePoint.x+":"+tilePoint.y],parentCtx.canvas=ctx,self.redrawTile(parentCtx.id)},2e3)},parseVectorTileLayer:function(vtl,ctx){var self=this,tilePoint=ctx.tile,layerCtx={canvas:null,id:ctx.id,tile:ctx.tile,zoom:ctx.zoom,tileSize:ctx.tileSize},layerOrdering;layerCtx.canvas=this._tiles[tilePoint.x+":"+tilePoint.y],this._canvasIDToFeatures[layerCtx.id]?this.clearTileFeatureHash(layerCtx.id):this._initializeFeaturesHash(layerCtx);for(var features=vtl.parsedFeatures,i=0,len=features.length;i<len;i++){var vtf=features[i];vtf.layer=vtl;var filter=this.options.filter;if("function"!=typeof filter||!1!==filter(vtf,layerCtx)){var getIDForLayerFeature,uniqueID=(0,Util.getIDForLayerFeature)(vtf)||i,mvtFeature=this.features[uniqueID],layerOrdering;if("function"==typeof(layerOrdering=this.options.layerOrdering)&&layerOrdering(vtf,layerCtx),mvtFeature)mvtFeature.addTileFeature(vtf,layerCtx);else{var style=this.style(vtf);this.features[uniqueID]=mvtFeature=new MVTFeature(this,vtf,layerCtx,uniqueID,style),style&&style.dynamicLabel&&"function"==typeof style.dynamicLabel&&this.featuresWithLabels.push(mvtFeature)}layerCtx&&layerCtx.id&&this._canvasIDToFeatures[layerCtx.id].features.push(mvtFeature)}}(layerOrdering=this.options.layerOrdering)&&(this._canvasIDToFeatures[layerCtx.id].features=this._canvasIDToFeatures[layerCtx.id].features.sort(function(a,b){return-(b.properties.zIndex-a.properties.zIndex)})),this.redrawTile(layerCtx.id)},setStyle:function(styleFn){for(var key in this._highestCount=0,this._lowestCount=null,this.style=styleFn,this.features){var feat;this.features[key].setStyle(styleFn)}var z=this.map.getZoom();for(var key in this._tiles){var id=z+":"+key;this.redrawTile(id)}},setHighestCount:function(count){count>this._highestCount&&(this._highestCount=count)},getHighestCount:function(){return this._highestCount},setLowestCount:function(count){(!this._lowestCount||count<this._lowestCount)&&(this._lowestCount=count)},getLowestCount:function(){return this._lowestCount},setCountRange:function(count){this.setHighestCount(count),this.setLowestCount(count)},handleClickEvent:function(evt,cb){var tileIDs=evt.tileID.split(":"),tileID=evt.tileID.split(":").slice(1,3).join(":"),zoom=evt.tileID.split(":")[0],canvas=this._tiles[tileID];canvas||cb(evt);for(var x=evt.layerPoint.x-canvas._leaflet_pos.x,y=evt.layerPoint.y-canvas._leaflet_pos.y,tilePoint={x:x,y:y},features=this._canvasIDToFeatures[evt.tileID].features,minDistance=Number.POSITIVE_INFINITY,nearest=null,j,paths,distance,i=0;i<features.length;i++){var feature=features[i];switch(feature.type){case 1:var radius=3;for(radius="function"==typeof feature.style.radius?feature.style.radius(zoom):feature.style.radius,paths=feature.getPathsForTile(evt.tileID),j=0;j<paths.length;j++)in_circle(paths[j][0].x,paths[j][0].y,radius,x,y)&&(nearest=feature,minDistance=0);break;case 2:for(paths=feature.getPathsForTile(evt.tileID),j=0;j<paths.length;j++){var distance,thickness;if(feature.style)(distance=this._getDistanceFromLine(tilePoint,paths[j]))<(feature.selected&&feature.style.selected?feature.style.selected.size:feature.style.size)/2+this.options.lineClickTolerance&&distance<minDistance&&(nearest=feature,minDistance=distance)}break;case 3:for(paths=feature.getPathsForTile(evt.tileID),j=0;j<paths.length;j++)this._isPointInPoly(tilePoint,paths[j])&&(nearest=feature,minDistance=0)}if(0==minDistance)break}nearest&&nearest.toggleEnabled&&nearest.toggle(),evt.feature=nearest,cb(evt)},clearTile:function(id){var ca=id.split(":"),canvasId=ca[1]+":"+ca[2];if(void 0!==this._tiles[canvasId]){var canvas=this._tiles[canvasId],context;canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height)}else console.error("typeof this._tiles[canvasId] === 'undefined'")},clearTileFeatureHash:function(canvasID){this._canvasIDToFeatures[canvasID]={features:[]}},clearLayerFeatureHash:function(){this.features={}},redrawTile:function(canvasID){this.clearTile(canvasID);var featfeats=this._canvasIDToFeatures[canvasID];if(featfeats){for(var features=featfeats.features,selectedFeatures=[],i=0;i<features.length;i++){var feature=features[i];feature.selected?selectedFeatures.push(feature):feature.draw(canvasID)}for(var j=0,len2=selectedFeatures.length;j<len2;j++){var selFeat;selectedFeatures[j].draw(canvasID)}}},_resetCanvasIDToFeatures:function(canvasID,canvas){this._canvasIDToFeatures[canvasID]={},this._canvasIDToFeatures[canvasID].features=[],this._canvasIDToFeatures[canvasID].canvas=canvas},linkedLayer:function(){if(this.mvtSource.layerLink){var linkName=this.mvtSource.layerLink(this.name);return this.mvtSource.layers[linkName]}return null},featureWithLabelAdded:function(feature){this.featuresWithLabels.push(feature)}})},{"./MVTFeature":9,"./MVTUtil":12}],11:[function(require,module,exports){var VectorTile=require("vector-tile").VectorTile,Protobuf=require("pbf"),Point=require("point-geometry"),Util=require("./MVTUtil"),MVTLayer=require("./MVTLayer");function getTileURL(lat,lon,zoom){var xtile,ytile;return zoom+":"+parseInt(Math.floor((lon+180)/360*(1<<zoom)))+":"+parseInt(Math.floor((1-Math.log(Math.tan(lat.toRad())+1/Math.cos(lat.toRad()))/Math.PI)/2*(1<<zoom)))}function tileLoaded(pbfSource,ctx){pbfSource.loadedTiles[ctx.id]=ctx}function parseVT(vt){for(var key in vt.layers){var lyr;parseVTFeatures(vt.layers[key])}return vt}function parseVTFeatures(vtl){vtl.parsedFeatures=[];for(var features,i=0,len=vtl._features.length;i<len;i++){var vtf=vtl.feature(i);vtf.coordinates=vtf.loadGeometry(),vtl.parsedFeatures.push(vtf)}return vtl}module.exports=L.TileLayer.MVTSource=L.TileLayer.Canvas.extend({options:{debug:!1,url:"",getIDForLayerFeature:function(){},tileSize:256,visibleLayers:[],xhrHeaders:{}},layers:{},processedTiles:{},_eventHandlers:{},_triggerOnTilesLoadedEvent:!0,_url:"",style:function(feature){var style={},type;switch(feature.type){case 1:style.color="rgba(49,79,79,1)",style.radius=5,style.selected={color:"rgba(255,255,0,0.5)",radius:6};break;case 2:style.color="rgba(161,217,155,0.8)",style.size=3,style.selected={color:"rgba(255,25,0,0.5)",size:4};break;case 3:style.color="rgba(49,79,79,1)",style.outline={color:"rgba(161,217,155,0.8)",size:1},style.selected={color:"rgba(255,140,0,0.3)",outline:{color:"rgba(255,140,0,1)",size:2}}}return style},initialize:function(options){L.Util.setOptions(this,options),this.layers={},this.activeTiles={},this.loadedTiles={},this._url=this.options.url,this.zIndex=options.zIndex,"function"==typeof options.style&&(this.style=options.style),"function"==typeof options.ajaxSource&&(this.ajaxSource=options.ajaxSource),this.layerLink=options.layerLink,this._eventHandlers={},this._tilesToProcess=0},redraw:function(triggerOnTilesLoadedEvent){!1===triggerOnTilesLoadedEvent&&(this._triggerOnTilesLoadedEvent=!1),L.TileLayer.Canvas.prototype.redraw.call(this)},onAdd:function(map){var self=this;self.map=map,L.TileLayer.Canvas.prototype.onAdd.call(this,map);var mapOnClickCallback=function(e){self._onClick(e)};map.on("click",mapOnClickCallback),map.on("layerremove",function(e){e.layer._leaflet_id===self._leaflet_id&&e.layer.removeChildLayers&&(e.layer.removeChildLayers(map),map.off("click",mapOnClickCallback))}),self.addChildLayers(map),"function"==typeof DynamicLabel&&(this.dynamicLabel=new DynamicLabel(map,this,{}))},drawTile:function(canvas,tilePoint,zoom){var ctx={id:[zoom,tilePoint.x,tilePoint.y].join(":"),canvas:canvas,tile:tilePoint,zoom:zoom,tileSize:this.options.tileSize};this._tilesToProcess<this._tilesToLoad&&(this._tilesToProcess=this._tilesToLoad);var id=ctx.id=Util.getContextID(ctx);this.activeTiles[id]=ctx,this.processedTiles[ctx.zoom]||(this.processedTiles[ctx.zoom]={}),this.options.debug&&this._drawDebugInfo(ctx),this._draw(ctx)},setOpacity:function(opacity){this._setVisibleLayersStyle("opacity",opacity)},setZIndex:function(zIndex){this._setVisibleLayersStyle("zIndex",zIndex)},_setVisibleLayersStyle:function(style,value){for(var key in this.layers)this.layers[key]._tileContainer.style[style]=value},_drawDebugInfo:function(ctx){var max=this.options.tileSize,g=ctx.canvas.getContext("2d");g.strokeStyle="#000000",g.fillStyle="#FFFF00",g.strokeRect(0,0,max,max),g.font="12px Arial",g.fillRect(0,0,5,5),g.fillRect(0,max-5,5,5),g.fillRect(max-5,0,5,5),g.fillRect(max-5,max-5,5,5),g.fillRect(max/2-5,max/2-5,10,10),g.strokeText(ctx.zoom+" "+ctx.tile.x+" "+ctx.tile.y,max/2-30,max/2-10)},_draw:function(ctx){var self=this;if(this._url){var src=this.getTileUrl({x:ctx.tile.x,y:ctx.tile.y,z:ctx.zoom}),xhr=new XMLHttpRequest;xhr.onload=function(){if("200"==xhr.status){if(!xhr.response)return;var arrayBuffer=new Uint8Array(xhr.response),buf=new Protobuf(arrayBuffer),vt=new VectorTile(buf);if(self.map&&self.map.getZoom()!=ctx.zoom)return void console.log("Fetched tile for zoom level "+ctx.zoom+". Map is at zoom level "+self._map.getZoom());self.checkVectorTileLayers(parseVT(vt),ctx),tileLoaded(self,ctx)}self.reduceTilesToProcessCount()},xhr.onerror=function(){console.log("xhr error: "+xhr.status)};try{xhr.open("GET",src,!0);var headers=self.options.xhrHeaders;for(var header in headers)xhr.setRequestHeader(header,headers[header]);xhr.responseType="arraybuffer",xhr.send()}catch(ex){}}},reduceTilesToProcessCount:function(){this._tilesToProcess--,this._tilesToProcess||(this._eventHandlers.PBFLoad&&this._eventHandlers.PBFLoad(),this._pbfLoaded())},checkVectorTileLayers:function(vt,ctx,parsed){var self=this;if(this.options.visibleLayers&&this.options.visibleLayers.length>0)for(var i=0;i<this.options.visibleLayers.length;i++){var layerName=this.options.visibleLayers[i];vt.layers[layerName]&&this.prepareMVTLayers(vt.layers[layerName],layerName,ctx,parsed)}else for(var key in vt.layers)this.prepareMVTLayers(vt.layers[key],key,ctx,parsed)},prepareMVTLayers:function(lyr,key,ctx,parsed){var self=this;this.layers[key]||(this.layers[key]=this.createMVTLayer(key,lyr.parsedFeatures[0].type||null)),parsed?this.layers[key].getCanvas(ctx,lyr):this.layers[key].parseVectorTileLayer(lyr,ctx)},createMVTLayer:function(key,type){var self=this,getIDForLayerFeature,options={getIDForLayerFeature:Util.getIDForLayerFeature,filter:this.options.filter,layerOrdering:this.options.layerOrdering,style:this.style,name:key,asynch:!0},layer;return this.options.zIndex&&(options.zIndex=this.zIndex),new MVTLayer(this,options).addTo(this.map)},getLayers:function(){return this.layers},hideLayer:function(id){this.layers[id]&&(this._map.removeLayer(this.layers[id]),this.options.visibleLayers.indexOf("id")>-1&&this.visibleLayers.splice(this.options.visibleLayers.indexOf("id"),1))},showLayer:function(id){this.layers[id]&&(this._map.addLayer(this.layers[id]),-1==this.options.visibleLayers.indexOf("id")&&this.visibleLayers.push(id)),this.bringToFront()},removeChildLayers:function(map){for(var key in this.layers){var layer=this.layers[key];map.removeLayer(layer)}},addChildLayers:function(map){var self=this;if(this.options.visibleLayers.length>0)for(var i=0;i<this.options.visibleLayers.length;i++){var layerName=this.options.visibleLayers[i],layer;(layer=this.layers[layerName])&&map.addLayer(layer)}else for(var key in this.layers){var layer;(layer=this.layers[key])._map||map.addLayer(layer)}},bind:function(eventType,callback){this._eventHandlers[eventType]=callback},_onClick:function(evt){var self=this,onClick=this.options.onClick,clickableLayers=this.options.clickableLayers,layers=this.layers;if(evt.tileID=getTileURL(evt.latlng.lat,evt.latlng.lng,this.map.getZoom()),clickableLayers||(clickableLayers=Object.keys(this.layers)),clickableLayers&&clickableLayers.length>0)for(var i=0,len=clickableLayers.length;i<len;i++){var key,layer=layers[clickableLayers[i]];layer&&layer.handleClickEvent(evt,function(evt){"function"==typeof onClick&&onClick(evt)})}else"function"==typeof onClick&&onClick(evt)},setFilter:function(filterFunction,layerName){for(var key in this.layers){var layer=this.layers[key];layerName?key.toLowerCase()==layerName.toLowerCase()&&(layer.options.filter=filterFunction,layer.clearLayerFeatureHash()):(layer.options.filter=filterFunction,layer.clearLayerFeatureHash())}},setStyle:function(styleFn,layerName){for(var key in this.layers){var layer=this.layers[key];layerName?key.toLowerCase()==layerName.toLowerCase()&&layer.setStyle(styleFn):layer.setStyle(styleFn)}},featureSelected:function(mvtFeature){this.options.mutexToggle&&(this._selectedFeature&&this._selectedFeature.deselect(),this._selectedFeature=mvtFeature),this.options.onSelect&&this.options.onSelect(mvtFeature)},featureDeselected:function(mvtFeature){this.options.mutexToggle&&this._selectedFeature&&(this._selectedFeature=null),this.options.onDeselect&&this.options.onDeselect(mvtFeature)},_pbfLoaded:function(){this.bringToFront();var self=this,onTilesLoaded=this.options.onTilesLoaded;onTilesLoaded&&"function"==typeof onTilesLoaded&&!0===this._triggerOnTilesLoadedEvent&&onTilesLoaded(this),this._triggerOnTilesLoadedEvent=!0}}),void 0===Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180})},{"./MVTLayer":10,"./MVTUtil":12,pbf:2,"point-geometry":4,"vector-tile":5}],12:[function(require,module,exports){var Util=module.exports={};Util.getContextID=function(ctx){return[ctx.zoom,ctx.tile.x,ctx.tile.y].join(":")},Util.getIDForLayerFeature=function(feature){return feature.properties.id},Util.getJSON=function(url,callback){var xmlhttp="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xmlhttp.onreadystatechange=function(){var status=xmlhttp.status;if(4===xmlhttp.readyState&&status>=200&&status<300){var json=JSON.parse(xmlhttp.responseText);callback(null,json)}else callback({error:!0,status:status})},xmlhttp.open("GET",url,!0),xmlhttp.send()}},{}],13:[function(require,module,exports){var Util=require("../MVTUtil");function StaticLabel(mvtFeature,ctx,latLng,style){var self=this;if(this.mvtFeature=mvtFeature,this.map=mvtFeature.map,this.zoom=ctx.zoom,this.latLng=latLng,this.selected=!1,mvtFeature.linkedFeature){var linkedFeature=mvtFeature.linkedFeature();linkedFeature&&linkedFeature.selected&&(this.selected=!0)}init(this,mvtFeature,ctx,latLng,style)}function init(self,mvtFeature,ctx,latLng,style){var ajaxData=mvtFeature.ajaxData,sty=self.style=style.staticLabel(mvtFeature,ajaxData),icon=self.icon=L.divIcon({className:sty.cssClass||"label-icon-text",html:sty.html,iconSize:sty.iconSize||[50,50]});self.marker=L.marker(latLng,{icon:icon}).addTo(self.map),self.selected&&self.marker._icon.classList.add(self.style.cssSelectedClass||"label-icon-text-selected"),self.marker.on("click",function(e){self.toggle()}),self.map.on("zoomend",function(e){var newZoom=e.target.getZoom();self.zoom!==newZoom&&self.map.removeLayer(self.marker)})}module.exports=StaticLabel,StaticLabel.prototype.toggle=function(){this.selected?this.deselect():this.select()},StaticLabel.prototype.select=function(){this.selected=!0,this.marker._icon.classList.add(this.style.cssSelectedClass||"label-icon-text-selected");var linkedFeature=this.mvtFeature.linkedFeature();linkedFeature.selected||linkedFeature.select()},StaticLabel.prototype.deselect=function(){this.selected=!1,this.marker._icon.classList.remove(this.style.cssSelectedClass||"label-icon-text-selected");var linkedFeature=this.mvtFeature.linkedFeature();linkedFeature.selected&&linkedFeature.deselect()},StaticLabel.prototype.remove=function(){this.map&&this.marker&&this.map.removeLayer(this.marker)}},{"../MVTUtil":12}],14:[function(require,module,exports){module.exports=require("./MVTSource")},{"./MVTSource":11}]},{},[14]);